#!/bin/bash

# Скрипт для первоначальной настройки сервера Ubuntu

# Выходить из скрипта при любой ошибке
set -e

# 1. Обновление списка пакетов
echo "======================================="
echo "Обновление списка пакетов (apt update)..."
echo "======================================="
sudo apt-get update

# 2. Обновление установленных пакетов
echo "======================================="
echo "Обновление системы (apt upgrade)..."
echo "======================================="
sudo apt-get upgrade -y

# 3. Установка необходимого программного обеспечения
echo "======================================="
echo "Установка основного набора программ..."
echo "======================================="
sudo apt-get install -y \
    nodejs \
    npm \
    nginx \
    wget \
    zip \
    unzip \
    net-tools \
    curl \
    htop \
    ufw \
    build-essential # Этот пакет важен для компиляции и сборки многих программ

# 4. Проверка версий установленных программ
echo "======================================="
echo "Проверка версий установленных программ:"
echo "======================================="
echo "Node.js: $(node -v)"
echo "NPM: $(npm -v)"
echo "Nginx: $(nginx -v 2>&1 | grep -o '[0-9./]*')"
echo "cURL: $(curl --version | head -n 1)"

# 5. Настройка и включение брандмауэра (UFW)
echo "======================================="
echo "Настройка базовых правил брандмауэра (UFW)..."
echo "======================================="
sudo ufw allow ssh     # Разрешить подключения по SSH (порт 22)
sudo ufw allow http    # Разрешить HTTP трафик (порт 80)
sudo ufw allow https   # Разрешить HTTPS трафик (порт 443)
sudo ufw --force enable # Включить брандмауэр без дополнительного подтверждения

echo "======================================="
echo "Статус брандмауэра:"
sudo ufw status verbose
echo "======================================="

echo "======================================="
echo "Установка и настройка завершены!"
echo "======================================="

